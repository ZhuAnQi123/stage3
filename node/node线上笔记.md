Nodeè¯¾ç¨‹ç¬”è®°

## Node ç®€ä»‹

### å®¢æˆ·ç«¯çš„JavaScriptæ˜¯æ€æ ·çš„

- ä»€ä¹ˆæ˜¯ JavaScriptï¼Ÿ
  +æ˜¯ä¸€ä¸ªè„šæœ¬è¯­è¨€
  +è¿è¡Œåœ¨æµè§ˆå™¨ï¼ˆæµè§ˆå™¨çš„jsè§£æå†…æ ¸  v8ï¼‰
  +å®ç°ç”¨æˆ·çš„äº¤äº’ ï¼ˆinteractiveï¼‰
  + å˜é‡  èµ‹å€¼   å¾ªç¯ é€»è¾‘ åˆ¤æ–­ åˆ†æ”¯ å¯¹è±¡   å‡½æ•°ã€‚ã€‚ã€‚ã€‚
  + dom æ“ä½œ
  + bom æ“ä½œ
  + ajax 
- JavaScript çš„è¿è¡Œç¯å¢ƒï¼Ÿ
  +æµè§ˆå™¨å†…æ ¸è§£æå†…æ ¸   es6  

- æµè§ˆå™¨ä¸­çš„ JavaScript å¯ä»¥åšä»€ä¹ˆï¼Ÿ


- æµè§ˆå™¨ä¸­çš„ JavaScript ä¸å¯ä»¥åšä»€ä¹ˆï¼Ÿï¼ˆä¸å®‰å…¨ï¼‰
  +è®¿é—®æ•°æ®åº“
  +ä¸èƒ½å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œ    
  +å¯¹os è¿›è¡Œæ“ä½œ
  +åŸå›  æ˜¯ä¸å®‰å…¨  å’Œæµè§ˆå™¨è¿è¡Œæœºåˆ¶æœ‰å…³
- åœ¨å¼€å‘äººå‘˜èƒ½åŠ›ç›¸åŒçš„æƒ…å†µä¸‹ç¼–ç¨‹è¯­è¨€çš„èƒ½åŠ›å–å†³äºä»€ä¹ˆï¼Ÿ

  +cordova hbuilder    å¹³å°  platform
  +java   javaè™šæ‹Ÿæœº        ï¼ˆè¿è¡Œå¹³å°ï¼‰
  +php    phpè™šæ‹Ÿæœº
  +c#     .net framework   mono
  +js     è§£æå†…æ ¸  chrome v8 
- JavaScript åªå¯ä»¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸­å—ï¼Ÿ
  +ä¸æ˜¯

### ä¸ºä»€ä¹ˆæ˜¯JavaScript
+ node js ä¸æ˜¯å› ä¸ºjs äº§ç”Ÿçš„
+ node é€‰æ‹©äº†js
+ Ryan dahl
+ 2009  2 æœˆä»½ nodeæœ‰æƒ³æ³•
+ 2009  5 æœˆä»½ githup å¼€æº
+ 2009  11æœˆä»½  jsconf  è®²è§£æ¨å¹¿node
+ 2010å¹´åº•    è¢«xxxå…¬å¸æ”¶è´­
+ 2018  å‘å¸ƒæœ‰é‡å¤§bug
+ npm 
+ githup ä¸–ç•Œä¸Šæœ€å¤§çš„åŒæ€§äº¤å‹ç½‘ç«™   ç äº‘  

### what is node ï¼Ÿ

- Node.js æ˜¯ä¸€ä¸ªåŸºäºChrome V8 å¼•æ“çš„JavaScriptè¿è¡Œç¯å¢ƒ
- Node.jsä½¿ç”¨äº†ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ã€éé˜»å¡å¼I/Oçš„æ¨¡å‹,ä½¿å…¶è½»é‡åˆé«˜æ•ˆ
- Node.jsçš„åŒ…ç®¡ç†å·¥å…·npm,æ˜¯å…¨çƒæœ€å¤§çš„å¼€æºåº“ç”Ÿæ€ç³»ç»Ÿ
- å®˜ç½‘ http://nodejs.cn/
- npm  æ’ä»¶å®˜ç½‘ï¼šhttps://www.npmjs.com/

## ç¯å¢ƒé…ç½®

### Nodeçš„å®‰è£…

- å®‰è£…åŒ…å®‰è£…
    + å®˜ç½‘ä¸‹è½½å¯¹åº”çš„å®‰è£…åŒ…
    + ä¸€è·¯next
- nvmå®‰è£…(æœ‰ä¸€ä¸ªç±»ä¼¼çš„å·¥å…·ï¼šn)
    + Node Version Managerï¼ˆNodeç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼‰
    
    + ç”±äºä»¥åçš„å¼€å‘å·¥ä½œå¯èƒ½ä¼šåœ¨å¤šä¸ªNodeç‰ˆæœ¬ä¸­æµ‹è¯•ï¼Œè€Œä¸”Nodeçš„ç‰ˆæœ¬ä¹Ÿæ¯”è¾ƒå¤šï¼Œæ‰€ä»¥éœ€è¦è¿™ä¹ˆæ¬¾å·¥å…·æ¥ç®¡ç†
    
    + [ä¸‹è½½åœ°å€](https://github.com/coreybutler/nvm-windows/releases)
    
      ```
      åŸºæœ¬å‘½ä»¤
      nvm -v æŸ¥çœ‹ç‰ˆæœ¬å·
      nvm list æŸ¥çœ‹åˆ—è¡¨
      nvm install ç‰ˆæœ¬å·  å®‰è£…node
      nvm uninstall ç‰ˆæœ¬å·  å¸è½½node
      ```
    
      
    
      
### ç›¸å…³ç‰ˆæœ¬

- nodeç‰ˆæœ¬å¸¸è¯†  
  + å¶æ•°ç‰ˆæœ¬ä¸ºç¨³å®šç‰ˆ  ï¼ˆ0.6.x ï¼Œ0.8.x ï¼Œ0.10.xï¼‰
  + å¥‡æ•°ç‰ˆæœ¬ä¸ºéç¨³å®šç‰ˆï¼ˆ0.7.x ï¼Œ0.9.x ï¼Œ0.11.xï¼‰
  + LTSï¼ˆLong Term Supportï¼‰
  + [LTSå’ŒCurrentåŒºåˆ«](https://blog.csdn.net/u012532033/article/details/73332099)
- æ“ä½œæ–¹å¼ï¼š
  + é‡æ–°ä¸‹è½½æœ€æ–°çš„å®‰è£…åŒ…ï¼›
  + è¦†ç›–å®‰è£…å³å¯ï¼›
- é—®é¢˜ï¼š
  + ä»¥å‰ç‰ˆæœ¬å®‰è£…çš„å¾ˆå¤šå…¨å±€çš„å·¥å…·åŒ…éœ€è¦é‡æ–°å®‰è£…
  + æ— æ³•å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬
  + æ— æ³•åœ¨å¤šä¸ªç‰ˆæœ¬ä¹‹é—´åˆ‡æ¢ï¼ˆå¾ˆå¤šæ—¶å€™æˆ‘ä»¬è¦ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬ï¼‰

### Windowsä¸‹å¸¸ç”¨çš„å‘½ä»¤è¡Œæ“ä½œ

- åˆ‡æ¢å½“å‰ç›®å½•ï¼ˆchange directoryï¼‰ï¼šcd
- åˆ›å»ºç›®å½•ï¼ˆmake directoryï¼‰ï¼šmkdir
- æŸ¥çœ‹å½“å‰ç›®å½•åˆ—è¡¨ï¼ˆdirectoryï¼‰ï¼šdir
  + åˆ«åï¼šlsï¼ˆlistï¼‰
- æ¸…ç©ºå½“å‰æ§åˆ¶å°ï¼šcls
  + åˆ«åï¼šclear
- åˆ é™¤æ–‡ä»¶ï¼šdel
  + åˆ«åï¼šrm

> æ³¨æ„ï¼šæ‰€æœ‰åˆ«åå¿…é¡»åœ¨æ–°ç‰ˆæœ¬çš„ PowerShell ï¼ˆlinuxç³»ç»Ÿï¼‰ä¸­ä½¿ç”¨

### å¸¸è§é—®é¢˜
- Pythonç¯å¢ƒä¸¢å¤±
 + Nodeä¸­æœ‰äº›ç¬¬ä¸‰æ–¹çš„åŒ…æ˜¯ä»¥C/C++æºç çš„æ–¹å¼å‘å¸ƒçš„ï¼Œéœ€è¦å®‰è£…åç¼–è¯‘,ç¡®ä¿å…¨å±€ç¯å¢ƒä¸­å¯ä»¥ä½¿ç”¨pythonå‘½ä»¤,python ç‰ˆæœ¬æ¨è2.7.0
- ç¯å¢ƒå˜é‡ä¸¢å¤±
 + éƒ¨åˆ†ç”µè„‘å®‰è£…å®Œæ¯•ä¹‹åæ²¡æœ‰ç¯å¢ƒå˜é‡éœ€è¦æ‰‹åŠ¨é…ç½®
 + Windowsä¸­ç¯å¢ƒå˜é‡åˆ†ä¸ºç³»ç»Ÿå˜é‡å’Œç”¨æˆ·å˜é‡
 + ç¯å¢ƒå˜é‡çš„å˜é‡åæ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„
 + PATH å˜é‡ï¼šåªè¦æ·»åŠ åˆ° PATH å˜é‡ä¸­çš„è·¯å¾„ï¼Œéƒ½å¯ä»¥åœ¨ä»»ä½•ç›®å½•ä¸‹
 + ç›®çš„å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒèµ·nodeå‘½ä»¤

 >
##æ¨¡å—,åŒ… commonjs

### commonjsè§„èŒƒ

å‰ç«¯æ¨¡å—åŒ–ï¼šAMD,CMD,Commonjs

Node åº”ç”¨ç”±æ¨¡å—ç»„æˆï¼Œé‡‡ç”¨ CommonJS æ¨¡å—è§„èŒƒã€‚

##### å®šä¹‰module

æ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæœ‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢å®šä¹‰çš„å˜é‡ã€å‡½æ•°ã€ç±»ï¼Œéƒ½æ˜¯ç§æœ‰çš„ï¼Œå¯¹å…¶ä»–æ–‡ä»¶ä¸å¯è§ã€‚

##### æš´éœ²æ¥å£

 CommonJSè§„èŒƒè§„å®šï¼Œæ¯ä¸ªæ¨¡å—å†…éƒ¨ï¼Œmoduleå˜é‡ä»£è¡¨å½“å‰æ¨¡å—ã€‚è¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„exportså±æ€§ï¼ˆå³module.exportsï¼‰æ˜¯å¯¹å¤–çš„æ¥å£ã€‚åŠ è½½æŸä¸ªæ¨¡å—ï¼Œå…¶å®æ˜¯åŠ è½½è¯¥æ¨¡å—çš„module.exportså±æ€§ã€‚

 ```javascript
 	var x = 5;
	var addX = function (value) {
	  return value + x;
	};
	module.exports.x = x;
	module.exports.addX = addX;
 ```
##### å¼•ç”¨

 requireæ–¹æ³•ç”¨äºåŠ è½½æ¨¡å—ã€‚

 ```
 	var example = require('./example.js');
	console.log(example.x); // 5
	console.log(example.addX(1)); // 6
 ```
### æ¨¡å—çš„åˆ†ç±»

* å†…ç½®æ¨¡å—
```
	const process = require('process')
	const path = require('path')
	console.log(process.version)
	console.log(path.resolve('../'))
```
* ç¬¬ä¸‰æ–¹æ¨¡å—
```
    const request=require("request");
	console.log(request)
	request.get('http://api.douban.com/v2/movie/in_theaters', (err, response, body) => {
	  if (!err) {
	    // console.log(body);
	    console.log(JSON.parse(body))
	  } else {
	    console.log(err);
	  }
	})
```
* è‡ªå®šä¹‰æ¨¡å—

###npm ä½¿ç”¨å…¥é—¨

 å®˜ç½‘:[https://www.npmjs.com/](https://www.npmjs.com/)

 å®‰è£…ï¼šæ— éœ€å®‰è£…

 æŸ¥çœ‹å½“å‰ç‰ˆæœ¬ï¼š

 ```
 $ npm -v
 ```

 æ›´æ–°ï¼š

 ```
 $ npm install npm@latest -g

 ```
 åˆå§‹åŒ–å·¥ç¨‹

 ```
 $ npm init

 $ npm init --yes é»˜è®¤é…ç½®
 ```

 å®‰è£…åŒ…

 ä½¿ç”¨npm installä¼šè¯»å–package.jsonæ–‡ä»¶æ¥å®‰è£…æ¨¡å—ã€‚å®‰è£…çš„æ¨¡å—åˆ†ä¸ºä¸¤ç±»
 dependencieså’ŒdevDependenciesï¼Œåˆ†åˆ«å¯¹åº”ç”Ÿäº§ç¯å¢ƒéœ€è¦çš„å®‰è£…åŒ…å’Œå¼€å‘ç¯å¢ƒéœ€è¦çš„å®‰è£…åŒ…ã€‚

 ```
 $ npm install

 $ npm install <package_name> 

 $ npm install <package_name> --save

 $ npm install <package_name> --save-dev
 ```
 æ›´æ–°æ¨¡å—

 ```
 $ npm update
 ```
 å¸è½½æ¨¡å—

 ```
 $ npm uninstall <package_name>

 $ npm uninstall --save lodash
 ```

é…ç½®npmæº

* ä¸´æ—¶ä½¿ç”¨, å®‰è£…åŒ…çš„æ—¶å€™é€šè¿‡--registryå‚æ•°å³å¯

  	$ npm install express --registry https://registry.npm.taobao.org

* å…¨å±€ä½¿ç”¨
	```
	  $ npm config set registry https://registry.npm.taobao.org
	  // é…ç½®åå¯é€šè¿‡ä¸‹é¢æ–¹å¼æ¥éªŒè¯æ˜¯å¦æˆåŠŸ
	  npm config get registry
	  // æˆ–
	  npm info express
	```

* cnpm ä½¿ç”¨
    ```
    	 // å®‰è£…cnpm
		  npm install -g cnpm --registry=https://registry.npm.taobao.org

		  // ä½¿ç”¨cnpmå®‰è£…åŒ…
		  cnpm install express
    ```

>

### å¸¸ç”¨çš„å†…ç½®æ¨¡å—

node å¸¸ç”¨å†…ç½®api  

(1) URL ç½‘å€è§£æ
    è§£æURLç›¸å…³ç½‘å€ä¿¡æ¯
    url.parse(urlString[, parseQueryString[, slashesDenoteHost]])
    url.format(urlObject)
    url.resolve(from, to)
(2) QueryString å‚æ•°å¤„ç†
    querystring.escape(str)
    querystring.unescape(str)
    querystring.parse(str[, sep[, eq[, options]]])
    querystring.stringify(obj[, sep[, eq[, options]]])
(3) HTTP æ¨¡å—æ¦‚è¦
	http.createServer([options][, requestListener])
	http.get(options[, callback])
	ç®€æ˜“çš„çˆ¬è™«
    ä»£ç†è·¨åŸŸå¤„ç†
(4) äº‹ä»¶ events æ¨¡å—
(5) æ–‡ä»¶fsæ¨¡å—
    æ‰“å°ç›®å½•æ ‘
(6) Stream æµæ¨¡å— 
    æ­Œè¯æ’­æ”¾
    éŸ³ä¹ä¸‹è½½
(8) request æ–¹æ³•


2ã€Node.js åŸºç¡€åº”ç”¨
1ã€åº”ç”¨ HTTP æ¨¡å—ç¼–å†™ä¸€ä¸ªå°çˆ¬è™«å·¥å…·
(1) åˆ©ç”¨çˆ¬è™«è·å–â€œæ‹‰å‹¾ç½‘â€é¦–é¡µåˆ—è¡¨æ•°æ® 
(2) é€šè¿‡ npm å®‰è£… cheerio æ¨¡å—è·å¾—æ•°æ®
2ã€åç«¯è¡¨å•çš„æäº¤
è¦æ±‚:
(1) åº”ç”¨ request post æ¨¡æ‹Ÿæäº¤è¡¨å•

### æ–‡ä»¶è¯»å–

Nodeä¸­æ–‡ä»¶è¯»å–çš„æ–¹å¼ä¸»è¦æœ‰ï¼š

> fs.readFile(file[, options], callback(error, data))

```javascript
fs.readFile('c:\\demo\1.txt', 'utf8', (err, data) => {
  if (err) throw err;
  console.log(data);
});
```

> fs.readFileSync(file[, options])

```javascript
try {
  //readFileSyncä¸ºåŒæ­¥å¤„ç†è¯»å–æ–‡ä»¶ï¼Œå¿…é¡»é‡‡ç”¨ try catchæ–¹æ³•
  const data = fs.readFileSync('c:\\demo\1.txt', 'utf8');
  console.log(data);
} catch(e) {
  // æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæˆ–è€…æƒé™é”™è¯¯----throwå°†é”™è¯¯æŠ›å‡ºå»
  throw e;
}
```

> fs.createReadStream(path[, options])

```javascript
const stream = fs.createReadStream('c:\\demo\1.txt');
let data = ''
stream.on('data', (trunk) => {
  data += trunk;  //trunkæ˜¯æ¯ä¸€æ¬¡ä¼ è¾“çš„ä¸€éƒ¨åˆ†
});
stream.on('end', () => {  //åŠ è½½å®Œæˆ
  console.log(data);
});
```

> *ç”±äºWindowså¹³å°ä¸‹é»˜è®¤æ–‡ä»¶ç¼–ç æ˜¯GBKï¼Œåœ¨Nodeä¸­ä¸æ”¯æŒï¼Œå¯ä»¥é€šè¿‡[iconv-lite](https://github.com/ashtuchkin/iconv-lite)è§£å†³*


### Readlineæ¨¡å—ã€é€è¡Œè¯»å–ã€‘æ–‡æœ¬å†…å®¹

```javascript
const readline = require('readline');
const fs = require('fs');

  /* ğŸ‘‡ readline.Interface ğŸ‘‡ç±»çš„å®ä¾‹æ˜¯ä½¿ç”¨ readline.createInterface() æ–¹æ³•æ„é€ çš„ã€‚ 
  æ¯ä¸ªå®ä¾‹éƒ½å…³è”ä¸€ä¸ª input å¯è¯»æµå’Œä¸€ä¸ª output å¯å†™æµã€‚ 
  output æµç”¨äºä¸ºåˆ°è¾¾çš„ç”¨æˆ·è¾“å…¥æ‰“å°æç¤ºï¼Œå¹¶ä» input æµè¯»å–ã€‚*/
const rl = readline.createInterface({
  input: fs.createReadStream('sample.txt')
});

rl.on('line', (line) => { //lineäº‹ä»¶--å–è¯»æ–‡ä»¶æ¯ä¸€è¡Œ
  console.log('Line from file:', line);
});
```


### æ–‡ä»¶å†™å…¥

Nodeä¸­æ–‡ä»¶å†™å…¥çš„æ–¹å¼ä¸»è¦æœ‰ï¼š

> fs.writeFile(file, data[, options], callback(error))

```javascript
fs.writeFile('c:\\demo\a.txt', new Date(), (error) => {
  console.log(error);
});
```

> fs.writeFileSync(file, data[, options])

```javascript
try {
  fs.writeFileSync('c:\\demo\a.txt', new Date());
} catch (error) {
  // æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œæˆ–è€…æƒé™é”™è¯¯
  console.log(error);
}
```

> fs.createWriteStream(path[,option])

```javascript
var streamWriter = fs.createWriteStream('c:\\demo\a.txt');
setInterval(() => {
  streamWriter.write(`${new Date}\n`, (error) => {
    console.log(error);
  });
}, 1000);
```
###nodeä¸­çš„å¼‚æ­¥æ“ä½œ


- fsæ¨¡å—å¯¹æ–‡ä»¶çš„å‡ ä¹æ‰€æœ‰æ“ä½œéƒ½æœ‰åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§å½¢å¼
- ä¾‹å¦‚ï¼šreadFile() å’Œ readFileSync()---åˆ†åˆ«ä¸ºå¼‚æ­¥/åŒæ­¥
- åŒºåˆ«ï¼š
  + åŒæ­¥è°ƒç”¨ä¼šé˜»å¡ä»£ç çš„æ‰§è¡Œï¼Œå¼‚æ­¥åˆ™ä¸ä¼š
  + å¼‚æ­¥è°ƒç”¨ä¼šå°†è¯»å–ä»»åŠ¡ä¸‹è¾¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ï¼Œç›´åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæˆæ‰ä¼šå›è°ƒ
  + å¼‚å¸¸å¤„ç†æ–¹é¢ï¼ŒåŒæ­¥å¿…é¡»ä½¿ç”¨ try catch æ–¹å¼ï¼Œå¼‚æ­¥å¯ä»¥é€šè¿‡å›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°

```javascript
console.time('sync');
try {
  var data = fs.readFileSync(path.join('C:\\Users\\iceStone\\Downloads', 'H.mp4'));
  // console.log(data);
} catch (error) {
  throw error;
}
console.timeEnd('sync');

console.time('async');
fs.readFile(path.join('C:\\Users\\iceStone\\Downloads', 'H.mp4'), (error, data) => {
  if (error) throw error;
  // console.log(data);
});
console.timeEnd('async');
```
#####  promise å¯¹è±¡çš„ä½¿ç”¨

å‚è€ƒèµ„æ–™ï¼š[JavaScript  Promiseè¿·ä½ ä¹¦](http://liubin.org/promises-book/#what-is-promise)

* what is Promise *
Promiseæ˜¯æŠ½è±¡å¼‚æ­¥å¤„ç†å¯¹è±¡ä»¥åŠå¯¹å…¶è¿›è¡Œå„ç§æ“ä½œçš„ç»„ä»¶ã€‚Promiseå¹¶ä¸æ˜¯ä»JavaScriptä¸­å‘ç¥¥çš„æ¦‚å¿µã€‚
Promiseæœ€åˆè¢«æå‡ºæ˜¯åœ¨ Eè¯­è¨€ä¸­ï¼Œ å®ƒæ˜¯åŸºäºå¹¶åˆ—/å¹¶è¡Œå¤„ç†è®¾è®¡çš„ä¸€ç§ç¼–ç¨‹è¯­è¨€ã€‚
ç°åœ¨JavaScriptä¹Ÿæ‹¥æœ‰äº†è¿™ç§ç‰¹æ€§ï¼Œè¿™å°±æ˜¯JavaScript Promise

ä½¿ç”¨äº†å›è°ƒå‡½æ•°çš„å¼‚æ­¥å¤„ç†

```javascript

----
getAsync("fileA.txt", function(error, result){
    if(error){// å–å¾—å¤±è´¥æ—¶çš„å¤„ç†
        throw error;
    }
    // å–å¾—æˆåŠŸæ—¶çš„å¤„ç†
});
----
<1> ä¼ ç»™å›è°ƒå‡½æ•°çš„å‚æ•°ä¸º(errorå¯¹è±¡ï¼Œ æ‰§è¡Œç»“æœ)é”™è¯¯ä¼˜å…ˆå¤„ç†
```

ä½¿ç”¨äº†å›è°ƒå‡½æ•°çš„å¼‚æ­¥å¤„ç†

```javascript
----
var promise = getAsyncPromise("fileA.txt"); 
promise.then(function(result){
    // è·å–æ–‡ä»¶å†…å®¹æˆåŠŸæ—¶çš„å¤„ç†
}).catch(function(error){
    // è·å–æ–‡ä»¶å†…å®¹å¤±è´¥æ—¶çš„å¤„ç†--åªç”¨å†™ä¸€æ¬¡ï¼Œæ‰€æœ‰å¤±è´¥çš„éƒ½ä¼šä¼ è¿‡æ¥
});
----
<1> è¿”å›promiseå¯¹è±¡
```

* åˆ›å»ºPromiseå¯¹è±¡ *

```
var promise = new Promise(function(resolve, reject) {
    // å¼‚æ­¥å¤„ç†
    // å¤„ç†ç»“æŸåã€è°ƒç”¨resolve æˆ– reject
    resolve('æˆåŠŸå¤„ç†')
    reject('é”™è¯¯å¤„ç†')
});
```
* ä½¿ç”¨å®ä¾‹ *

1. åˆ›å»ºä¸€ä¸ªpriomise å¯¹è±¡å¹¶è¿”å›`new Promise(fn)`
2. åœ¨fn ä¸­æŒ‡å®šå¼‚æ­¥ç­‰å¤„ç†
	* å¤„ç†ç»“æœæ­£å¸¸---è°ƒç”¨`resolve(å¤„ç†ç»“æœå€¼)`
	* å¤„ç†ç»“æœé”™è¯¯---è°ƒç”¨ `reject(Errorå¯¹è±¡)`

```javascript
function asyncFunction() {
    return new Promise(function (resolve, reject) {
        setTimeout(function () {
            resolve('Async Hello world');
        }, 16);
    });
}

asyncFunction().then(function (value) {
    console.log(value);    // => 'Async Hello world'
}).catch(function (error) {
    console.log(error);
});
```

* Promiseçš„çŠ¶æ€

ç”¨new Promise å®ä¾‹åŒ–çš„promiseå¯¹è±¡æœ‰ä»¥ä¸‹ä¸‰ä¸ªçŠ¶æ€ã€‚

* **"has-resolution" - Fulfilled**   resolve(æˆåŠŸ)æ—¶ã€‚

* **"has-rejection" - Rejected**     reject(å¤±è´¥)æ—¶

* **"unresolved" - Pending**   æ—¢ä¸æ˜¯resolveä¹Ÿä¸æ˜¯rejectçš„çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯promiseå¯¹è±¡åˆšè¢«åˆ›å»ºåçš„åˆå§‹åŒ–çŠ¶æ€ç­‰

promiseå¯¹è±¡çš„çŠ¶æ€ï¼Œä»Pendingè½¬æ¢ä¸ºFulfilledæˆ–Rejectedä¹‹åï¼Œ è¿™ä¸ªpromiseå¯¹è±¡çš„çŠ¶æ€å°±ä¸ä¼šå†å‘ç”Ÿä»»ä½•å˜åŒ–ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼ŒPromiseä¸Eventç­‰ä¸åŒï¼Œåœ¨.then åæ‰§è¡Œçš„å‡½æ•°å¯ä»¥è‚¯å®šåœ°è¯´åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚

å¦å¤–ï¼ŒFulfilledå’ŒRejectedè¿™ä¸¤ä¸ªä¸­çš„ä»»ä¸€çŠ¶æ€éƒ½å¯ä»¥è¡¨ç¤ºä¸ºSettled(ä¸å˜çš„)ã€‚

Settled
resolve(æˆåŠŸ) æˆ– reject(å¤±è´¥)ã€‚

ä»Pendingå’ŒSettledçš„å¯¹ç§°å…³ç³»æ¥çœ‹ï¼ŒPromiseçŠ¶æ€çš„ç§ç±»/è¿ç§»æ˜¯éå¸¸ç®€å•æ˜“æ‡‚çš„ã€‚

å½“promiseçš„å¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç”¨.then æ¥å®šä¹‰åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡çš„å‡½æ•°ã€‚

### è·¯å¾„æ¨¡å—

åœ¨æ–‡ä»¶æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œéƒ½å¿…é¡»ä½¿ç”¨ç‰©ç†è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„ï¼‰ï¼Œpathæ¨¡å—æä¾›äº†ä¸€ç³»åˆ—ä¸è·¯å¾„ç›¸å…³çš„ API

```javascript
console.log('joinç”¨äºæ‹¼æ¥å¤šä¸ªè·¯å¾„éƒ¨åˆ†ï¼Œå¹¶è½¬åŒ–ä¸ºæ­£å¸¸æ ¼å¼');
const temp = path.join(__dirname, '..', 'lyrics', './å‹è°Šä¹‹å…‰.lrc');
console.log(temp);

console.log('è·å–è·¯å¾„ä¸­çš„æ–‡ä»¶å');
console.log(path.basename(temp));

console.log('è·å–è·¯å¾„ä¸­çš„æ–‡ä»¶åå¹¶æ’é™¤æ‰©å±•å');
console.log(path.basename(temp, '.lrc'));

console.log('====================================');

console.log('è·å–ä¸åŒæ“ä½œç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦');
console.log(process.platform + 'çš„åˆ†éš”ç¬¦ä¸º ' + path.delimiter);

console.log('ä¸€èˆ¬ç”¨äºåˆ†å‰²ç¯å¢ƒå˜é‡');
console.log(process.env.PATH.split(path.delimiter));

console.log('====================================');

console.log('è·å–ä¸€ä¸ªè·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†');
console.log(path.dirname(temp));

console.log('====================================');

console.log('è·å–ä¸€ä¸ªè·¯å¾„ä¸­æœ€åçš„æ‰©å±•å');
console.log(path.extname(temp));

console.log('====================================');

console.log('å°†ä¸€ä¸ªè·¯å¾„è§£ææˆä¸€ä¸ªå¯¹è±¡çš„å½¢å¼');
const pathObject = path.parse(temp);
console.log(pathObject);

console.log('====================================');

console.log('å°†ä¸€ä¸ªè·¯å¾„å¯¹è±¡å†è½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²çš„å½¢å¼');
// pathObject.name = 'æˆ‘ç»ˆäºå¤±å»äº†ä½ ';
pathObject.base = 'æˆ‘ç»ˆäºå¤±å»äº†ä½ .lrc';
console.log(pathObject);

console.log(path.format(pathObject));

console.log('====================================');

console.log('è·å–ä¸€ä¸ªè·¯å¾„æ˜¯ä¸æ˜¯ç»å¯¹è·¯å¾„');
console.log(path.isAbsolute(temp));
console.log(path.isAbsolute('../lyrics/çˆ±çš„ä»£ä»·.lrc'));

console.log('====================================');

console.log('å°†ä¸€ä¸ªè·¯å¾„è½¬æ¢ä¸ºå½“å‰ç³»ç»Ÿé»˜è®¤çš„æ ‡å‡†æ ¼å¼ï¼Œå¹¶è§£æå…¶ä¸­çš„./å’Œ../');
console.log(path.normalize('c:/develop/demo\\hello/../world/./a.txt'));

console.log('====================================');

console.log('è·å–ç¬¬äºŒä¸ªè·¯å¾„ç›¸å¯¹ç¬¬ä¸€ä¸ªè·¯å¾„çš„ç›¸å¯¹è·¯å¾„');
console.log(path.relative(__dirname, temp));

console.log('====================================');

console.log('ä»¥ç±»ä¼¼å‘½ä»¤è¡Œcdå‘½ä»¤çš„æ–¹å¼æ‹¼æ¥è·¯å¾„');
console.log(path.resolve(temp, 'c:/', './develop', '../application'));

console.log('====================================');

console.log('è·å–ä¸åŒå¹³å°ä¸­è·¯å¾„çš„åˆ†éš”ç¬¦ï¼ˆé»˜è®¤ï¼‰');
console.log(path.sep);

console.log('====================================');

console.log('å…è®¸åœ¨ä»»æ„å¹³å°ä¸‹ä»¥WIN32çš„æ–¹æ³•è°ƒç”¨PATHå¯¹è±¡');
// console.log(path.win32);
console.log(path === path.win32);

console.log('====================================');

console.log('å…è®¸åœ¨ä»»æ„å¹³å°ä¸‹ä»¥POSIXçš„æ–¹æ³•è°ƒç”¨PATHå¯¹è±¡');
console.log(path === path.posix);
```

### express 

---

å®˜ç½‘:[http://www.expressjs.com.cn/](http://www.expressjs.com.cn/)


#### express ç¯å¢ƒæ­å»º

å®‰è£…

```bash
	$ npm install express --save
```

å¿«é€Ÿå¼€å§‹

```javascript
	const express = require('express')
    const app = express()
    app.get('/', (req, res) => res.send('Hello World!'))
    app.listen(3000, () => console.log('Example app listening on port 3000!'))
```

#### express è·¯ç”±é…ç½®


```javascript
let express=require('express')
let router=express.Router()
// è¯¥è·¯ç”±ä½¿ç”¨çš„ä¸­é—´ä»¶
router.use((req,res,next)=>{
	 next()
});
// å®šä¹‰ç½‘ç«™ä¸»é¡µçš„è·¯ç”±
router.post('/addFood', function(req, res) {
	console.log('hahaha')
  // res.send('è¿™é‡Œæ˜¯adminçš„ç™»å½•');
});
// å®šä¹‰ about é¡µé¢çš„è·¯ç”±
router.post('/regist', function(req, res) {
  res.send('è¿™é‡Œæ˜¯adminçš„æ³¨å†Œä¾§');
});

module.exports = router;

app.use('/admin',admin)
```

#### ä¼ é€’æ•°æ®çš„è·å–

	get
	req.query
	post
	req.body
	body-parser
	
	è®¾ç½®ä¸­æ–‡æ ¼å¼
	res.set('Content-Type','text/plain,charset=utf8')

#### è¯·æ±‚æ¨¡æ‹Ÿå·¥å…· postman

#### é™æ€èµ„æºé…ç½®

```javascript

app.use(express.static('public'))

app.use('/static', express.static('public'))

app.use('/static', express.static(path.join(__dirname, 'public')))

```

## mongod

### å®‰è£…é…ç½®
> åœ¨`Mongodb`å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„[Mongodbä¸‹è½½åœ°å€](https://cloud.mongodb.com/)
> 
> ä¸‹è½½`msi`çš„`window`å®‰è£…åŒ…ï¼Œå¯ä»¥è£…åˆ°Cç›˜æˆ–è€…Dç›˜ç›®å½•ä¸‹
> 
> # é…ç½®
> ç”±äºæˆ‘æ˜¯å®‰è£…åœ¨Dç›˜çš„ç¯å¢ƒä¸‹
> 
> ```shell
> D:\Program Files (x86)\MongoDB\Server\3.2\bin
> ```
> 
> æ‰€ä»¥åœ¨binæ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°mongod.exeå‘½ä»¤ï¼Œç„¶åé€šè¿‡ç®¡ç†å‘˜æ‰§è¡Œ`mongod --dbpath xè·¯å¾„x`ï¼Œè·¯å¾„å¯ä»¥æ˜¯ä»»ä½•åœ°æ–¹ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©åœ¨Dç›˜çš„MongoDBç›®å½•ä¸‹ï¼Œå½“ç„¶è·¯å¾„ä¸è¦åŒ…å«ç‰¹æ®Šçš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚`Program Files (x86)`ä¹Ÿä¸è¡Œ
> 
> ```shell
> mongod --dbpath D:\mongodb\data\db
> ```
> 
> ![image](https://user-images.githubusercontent.com/17243165/31977540-fc0a5a6e-b96f-11e7-9a2b-34d66d7241c4.png)
> 
> # å‘½ä»¤è¡Œ
> ç»è¿‡ä¸Šé¢çš„é…ç½®ä¹‹åï¼Œå°±å¯ä»¥è¿”å›binç›®å½•ä¸‹æ‰¾åˆ°`mongo.exe`å‘½ä»¤ï¼Œå¹¶ç®¡ç†å‘˜ä¸‹æ‰§è¡Œï¼Œå°±å¯ä»¥å‡ºç°mongodbçš„å‘½ä»¤è¡Œæ¨¡å¼
> 
> ```shell
> D:\Program Files (x86)\MongoDB\Server\3.2\bin
> ```
> 
> ![image](https://user-images.githubusercontent.com/17243165/31978099-57bce3ca-b972-11e7-88bd-30f5d68036ed.png)
> 
> ç„¶åå°±å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æµ‹è¯•äº†
>
### mongod
> ```js
> db.help()//å¸®åŠ©
> db.stats()//ç»Ÿè®¡
> ```
> 
> # æ˜¾ç¤ºæ•°æ®åº“
> ```js
> show dbs
> ```
> 
> æ£€æŸ¥å½“å‰é€‰æ‹©çš„æ•°æ®åº“
> 
> ```js
> db
> ```
> 
> # æ·»åŠ æ•°æ®åº“
> **æ•°æ®åº“å**ä¸ºæ•°æ®åº“åˆ›å»ºçš„åå­—ï¼Œä½¿ç”¨è¯¥å‘½ä»¤åä¼šé»˜è®¤åˆ‡æ¢åˆ°å¯¹åº”çš„æ•°æ®åº“ï¼Œå¹¶ä¸”åœ¨æ•°æ®åº“ä¸­æ·»åŠ é€‰é¡¹ï¼Œæ•°æ®åº“ä¿¡æ¯æ‰æ˜¾ç¤ºï¼Œå¦‚æœé»˜è®¤å°±æœ‰è¯¥æ•°æ®åº“ï¼Œé‚£å°±æ˜¯åˆ‡æ¢åˆ°å¯¹åº”çš„æ•°æ®åº“é‡Œé¢
> 
> ```js
> use æ•°æ®åº“å
> ```
> 
> # åˆ é™¤æ•°æ®åº“
> å…ˆåˆ‡æ¢åˆ°å¯¹åº”çš„æ•°æ®åº“ï¼Œç„¶åå†æ‰§è¡Œ`db.dropDatabase()`åˆ é™¤è¯¥æ•°æ®åº“
> 
> ```js
> use æ•°æ®åº“å
> //switched to db æ•°æ®åº“å
> db.dropDatabase()
> ```
> 
> # æ˜¾ç¤ºé›†åˆ
> ç”¨ä¸€ä¸‹å‘½ä»¤å¯ä»¥æ£€æŸ¥åˆ›å»ºçš„é›†åˆ
> 
> ```js
> show collections
> ```
> 
> # æ·»åŠ é›†åˆ
> åœ¨åˆ›å»ºå®Œæ•°æ®åº“ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºé›†åˆ
> 
> ```js
> db.createCollection(é›†åˆåå­—nameï¼Œè®¾ç½®å‚æ•°options[å¯¹è±¡ç±»å‹])
> ```
> 
> **name**æ˜¯è¦åˆ›å»ºçš„é›†åˆçš„åç§°ã€‚ **options**æ˜¯ä¸€ä¸ªæ–‡æ¡£ï¼Œç”¨äºæŒ‡å®šé›†åˆçš„é…ç½®
> 
> å‚æ•°	ç±»å‹	æè¿°
> name	String	è¦åˆ›å»ºçš„é›†åˆçš„åç§°
> options	Document	(å¯é€‰)æŒ‡å®šæœ‰å…³å†…å­˜å¤§å°å’Œç´¢å¼•çš„é€‰é¡¹
> **options**å‚æ•°æ˜¯å¯é€‰çš„ï¼Œå› æ­¤åªéœ€è¦æŒ‡å®šé›†åˆçš„åç§°ã€‚ ä»¥ä¸‹æ˜¯å¯ä»¥ä½¿ç”¨çš„é€‰é¡¹åˆ—è¡¨ï¼š
> 
> å­—æ®µ	ç±»å‹	æè¿°
> capped	Boolean	(å¯é€‰)å¦‚æœä¸ºtrueï¼Œåˆ™å¯ç”¨å°é—­çš„é›†åˆã€‚ä¸Šé™é›†åˆæ˜¯å›ºå®šå¤§å°çš„é›†åˆï¼Œå®ƒåœ¨è¾¾åˆ°å…¶æœ€å¤§å¤§å°æ—¶è‡ªåŠ¨è¦†ç›–å…¶æœ€æ—§çš„æ¡ç›®ã€‚ å¦‚æœæŒ‡å®štrueï¼Œåˆ™è¿˜éœ€è¦æŒ‡å®šsizeå‚æ•°ã€‚
> autoIndexId	Boolean	(å¯é€‰)å¦‚æœä¸ºtrueï¼Œåˆ™åœ¨_idå­—æ®µä¸Šè‡ªåŠ¨åˆ›å»ºç´¢å¼•ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚
> size	æ•°å­—	(å¯é€‰)æŒ‡å®šä¸Šé™é›†åˆçš„æœ€å¤§å¤§å°(ä»¥å­—èŠ‚ä¸ºå•ä½)ã€‚ å¦‚æœcappedä¸ºtrueï¼Œé‚£ä¹ˆè¿˜éœ€è¦æŒ‡å®šæ­¤å­—æ®µçš„å€¼ã€‚
> max	æ•°å­—	(å¯é€‰)æŒ‡å®šä¸Šé™é›†åˆä¸­å…è®¸çš„æœ€å¤§æ–‡æ¡£æ•°ã€‚
> ç”±äº**option**æ˜¯å¯é€‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸å¸¦é…ç½®é¡¹åˆ›å»ºé›†åˆ
> 
> ```js
> db.createCollection("mycollection")
> ```
> 
> # åˆ é™¤é›†åˆ
> `db.collection.drop()`ç”¨äºä»æ•°æ®åº“ä¸­åˆ é™¤é›†åˆ
> 
> ```js
> db.é›†åˆå.drop()
> ```
> 
> æ¯”å¦‚æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä»¥ä¸‹æ“ä½œ
> 
> ```js
> db.createCollection("wscats")//åˆ›å»ºåä¸ºwscatsçš„é›†åˆ
> show collections//æ˜¾ç¤ºè¯¥æ•°æ®åº“æ‰€æœ‰é›†åˆ   wscats
> db.wscats.drop()//åˆ é™¤åä¸ºwscatsçš„é›†åˆ
> ```
> 
> # æŸ¥çœ‹æ–‡æ¡£
> æœ€ç®€å•æŸ¥çœ‹æ–‡æ¡£çš„æ–¹æ³•å°±æ˜¯`find()`ï¼Œä¼šæ£€ç´¢é›†åˆä¸­æ‰€æœ‰çš„æ–‡æ¡£ç»“æœ
> 
> ```js
> db.é›†åˆå.find()
> ```
> 
> è¦ä»¥æ ¼å¼åŒ–çš„æ–¹å¼æ˜¾ç¤ºç»“æœï¼Œå¯ä»¥ä½¿ç”¨`pretty()`æ–¹æ³•ã€‚
> 
> ```js
> db.é›†åˆå.find().pretty()
> ```
> 
> ## 1.å›ºå€¼å¯»æ‰¾
> å¯»æ‰¾ageé›†åˆé‡Œé¢æ‰€æœ‰å«æœ‰å±æ€§å€¼ä¸ºwscatsçš„æ–‡æ¡£ç»“æœï¼Œç›¸å½“äº`where name = 'wscats'`
> 
> ```js
> db.age.find({name:"wscats"})
> ```
> 
> ## 2.èŒƒå€¼å¯»æ‰¾
> æ“ä½œ	è¯­æ³•	ç¤ºä¾‹	ç­‰æ•ˆè¯­å¥
> ç›¸ç­‰	{:}	`db.age.find({"name":"wscats"}).pretty()`	where name = 'wscats'
> å°äº	{:{$lt:}}	`db.age.find({"likes":{$lt:50}}).pretty()`	where likes < 50
> å°äºç­‰äº	{:{$lte:}}	`db.age.find({"likes":{$lte:50}}).pretty()`	where likes <= 50
> å¤§äº	{:{$gt:}}	`db.age.find({"likes":{$gt:50}}).pretty()`	where likes > 50
> å¤§äºç­‰äº	{:{$gte:}}	`db.age.find({"likes":{$gte:50}}).pretty()`	where likes >= 50
> ä¸ç­‰äº	{:{$ne:}}	`db.age.find({"likes":{$ne:50}}).pretty()`	where likes != 50
> ## 3.ANDå’ŒORå¯»æ‰¾
> ### AND
> åœ¨find()æ–¹æ³•ä¸­ï¼Œå¦‚æœé€šè¿‡ä½¿ç”¨`ï¼Œ`å°†å®ƒä»¬åˆ†å¼€ä¼ é€’å¤šä¸ªé”®ï¼Œåˆ™mongodbå°†å…¶è§†ä¸º**AND**æ¡ä»¶ã€‚ ä»¥ä¸‹æ˜¯ANDçš„åŸºæœ¬è¯­æ³•
> 
> å¯»æ‰¾`_id`ä¸º1å¹¶ä¸”`name`ä¸ºwscatsçš„æ‰€æœ‰ç»“æœé›†
> 
> ```js
> db.age.find(
>    {
>       $and: [
>          {"_id": 1}, {"name": "wscats"}
>       ]
>    }
> )
> ```
> 
> ### OR
> åœ¨è¦æ ¹æ®ORæ¡ä»¶æŸ¥è¯¢æ–‡æ¡£ï¼Œéœ€è¦ä½¿ç”¨`$or`å…³é”®å­—ã€‚ä»¥ä¸‹æ˜¯ORæ¡ä»¶çš„åŸºæœ¬è¯­æ³•
> 
> å¯»æ‰¾`name`ä¸ºcorrineæˆ–è€…`name`ä¸ºwscatsçš„æ‰€æœ‰ç»“æœé›†
> 
> ```js
> db.age.find(
>    {
>       $or: [
>          {"name": "corrine"}, {â€œnameâ€œ: "wscats"}
>       ]
>    }
> )
> ```
> 
> ### ANDå’ŒORç­‰ç»“åˆ
> ç›¸å½“äºè¯­å¥`where title = "wscats" OR ( title = "corrine" AND _id < 5)`
> 
> ```js
> db.age.find({
>   $or: [{
>     "title": "wscats"
>   }, {
>     $and: [{
>       "title": "corrine"
>     }, {
>       "_id": {
>         $lte: 5
>       }
>     }]
>   }]
> })
> ```
> 
> # æ’å…¥æ–‡æ¡£
> æ–‡æ¡£çš„æ•°æ®ç»“æ„å’ŒJSONåŸºæœ¬ä¸€æ ·ã€‚
> æ‰€æœ‰å­˜å‚¨åœ¨é›†åˆä¸­çš„æ•°æ®éƒ½æ˜¯BSONæ ¼å¼ã€‚
> BSONæ˜¯ä¸€ç§ç±»jsonçš„ä¸€ç§äºŒè¿›åˆ¶å½¢å¼çš„å­˜å‚¨æ ¼å¼,ç®€ç§°**Binary JSON**ã€‚
> 
> è¦å°†æ•°æ®æ’å…¥åˆ°mongodbé›†åˆä¸­ï¼Œéœ€è¦ä½¿ç”¨mongodbçš„`insert()`æˆ–`save()`æ–¹æ³•ã€‚
> 
> ```js
> db.é›†åˆå.insert(document)
> ```
> 
> æ¯”å¦‚æˆ‘ä»¬å¯ä»¥æ’å…¥ä»¥ä¸‹æ•°æ®
> 
> ```js
> db.wscats.insert({
>    _id: 100,
>    title: 'MongoDB Tutorials', 
>    description: 'node_tutorials',
>    by: 'Oaoafly',
>    url: 'https://github.com/Wscats/node-tutorial',
>    tags: ['wscat','MongoDB', 'database', 'NoSQL','node'],
>    num: 100,
> })
> ```
> 
> ä¹Ÿå¯ä»¥æ”¯æŒæ’å…¥å¤šä¸ªï¼Œæ³¨æ„ä¼ å…¥çš„æ˜¯æ•°ç»„å½¢å¼
> 
> ```js
> db.wscats.insert([{
>    _id: 100,
>    title: â€˜Helloâ€™
> },{
>    _id: 101,
>    title: â€˜Worldâ€™
> }])
> ```
> 
> åœ¨æ’å…¥çš„æ–‡æ¡£ä¸­ï¼Œå¦‚æœä¸æŒ‡å®š_idå‚æ•°ï¼Œé‚£ä¹ˆmongodbä¼šä¸ºæ­¤æ–‡æ¡£åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ObjectId
> è¦æ’å…¥æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`db.post.save(document)`ã€‚å¦‚æœä¸åœ¨æ–‡æ¡£ä¸­æŒ‡å®š_idï¼Œé‚£ä¹ˆ`save()`æ–¹æ³•å°†ä¸`insert()`æ–¹æ³•ä¸€æ ·è‡ªåŠ¨åˆ†é…IDçš„å€¼ã€‚å¦‚æœæŒ‡å®š_idï¼Œåˆ™å°†ä»¥save()æ–¹æ³•çš„å½¢å¼æ›¿æ¢åŒ…å«**_id**çš„æ–‡æ¡£çš„å…¨éƒ¨æ•°æ®ã€‚
> 
> ```js
> db.wscats.save({
>    _id: 111,
>    title: 'Oaoafly Wscats', 
> })
> ```
> 
> # æ›´æ–°æ–‡æ¡£
> ## 1.update()æ–¹æ³•
> å¯»æ‰¾ç¬¬ä¸€æ¡titleä¸ºwscatsçš„å€¼ï¼Œå¹¶ä¸”æ›´æ–°å€¼titleä¸ºcorrineå’Œageä¸º12
> 
> ```js
> db.age.update({
>   'title': 'wscats'
> }, {
>   $set: {
>     'title': 'corrine',
>     'age': 12
>   }
> })
> ```
> 
> é»˜è®¤æƒ…å†µä¸‹ï¼Œmongodbåªä¼šæ›´æ–°ä¸€ä¸ªæ–‡æ¡£ã€‚è¦æ›´æ–°å¤šä¸ªæ–‡æ¡£ï¼Œéœ€è¦å°†å‚æ•°`multi`è®¾ç½®ä¸ºtrueï¼Œè¿˜å¯ä»¥é…åˆfindæ–¹æ³•é‡Œé¢çš„å„ç§å¤æ‚æ¡ä»¶åˆ¤æ–­æ¥ç­›é€‰ç»“æœï¼Œç„¶åæ›´æ–°å¤šä¸ªæ–‡æ¡£
> 
> å¯»æ‰¾æ‰€æœ‰titleä¸ºwscatsçš„å€¼ï¼Œå¹¶ä¸”æ›´æ–°å€¼titleä¸ºcorrineå’Œageä¸º12
> 
> ```js
> db.age.update({
>   'title': 'wscats'
> }, {
>   $set: {
>     'title': 'corrine',
>     'age': 12
>   }
> }, {
>   multi: true
> })
> ```
> 
> ## 2.save()æ–¹æ³•
> å°†`_id`ä¸»é”®ä¸º3çš„æ–‡æ¡£ï¼Œè¦†ç›–æ–°çš„å€¼ï¼Œæ³¨æ„`_id`ä¸ºå¿…ä¼ 
> 
> ```
> db.age.save({
>   '_id':3,
>   'title': 'wscats'
> })
> ```
> # åˆ é™¤æ–‡æ¡£
> åˆ é™¤ä¸»é”®`_id`ä¸º3çš„æ–‡æ¡£ï¼Œé»˜è®¤æ˜¯åˆ é™¤å¤šæ¡
> 
> ```js
> db.age.remove({
>   '_id':3
> })
> ```
> 
> å»ºè®®åœ¨æ‰§è¡Œ`remove()`å‡½æ•°å‰å…ˆæ‰§è¡Œ`find()`å‘½ä»¤æ¥åˆ¤æ–­æ‰§è¡Œçš„æ¡ä»¶æ˜¯å¦æ­£ç¡®
> 
> å¦‚æœä½ åªæƒ³åˆ é™¤ç¬¬ä¸€æ¡æ‰¾åˆ°çš„è®°å½•å¯ä»¥è®¾ç½®**justOne**ä¸º1ï¼Œå¦‚ä¸‹æ‰€ç¤º
> 
> ```js
> db.age.remove({...},1)
> ```
> 
> å…¨éƒ¨åˆ é™¤
> 
> ```js
> db.age.remove({})
> ```
> 
> # Limitä¸Skipæ–¹æ³•
> ## Limit
> å¦‚æœä½ éœ€è¦åœ¨mongodbä¸­è¯»å–æŒ‡å®šæ•°é‡çš„æ•°æ®è®°å½•ï¼Œå¯ä»¥ä½¿ç”¨mongodbçš„Limitæ–¹æ³•ï¼Œ`limit()`æ–¹æ³•æ¥å—ä¸€ä¸ªæ•°å­—å‚æ•°ï¼Œè¯¥å‚æ•°æŒ‡å®šä»mongodbä¸­è¯»å–çš„è®°å½•æ¡æ•°ã€‚
> 
> ```js
> db.age.find().limit(æ•°é‡)
> ```
> 
> ## Skip
> æˆ‘ä»¬é™¤äº†å¯ä»¥ä½¿ç”¨`limit()`æ–¹æ³•æ¥è¯»å–æŒ‡å®šæ•°é‡çš„æ•°æ®å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨`skip()`æ–¹æ³•æ¥è·³è¿‡æŒ‡å®šæ•°é‡çš„æ•°æ®ï¼Œskipæ–¹æ³•åŒæ ·æ¥å—ä¸€ä¸ªæ•°å­—å‚æ•°ä½œä¸ºè·³è¿‡çš„è®°å½•æ¡æ•°ã€‚
> 
> ```js
> db.age.find().limit(æ•°é‡).skip(æ•°é‡)
> //skip()æ–¹æ³•é»˜è®¤å€¼ä¸º0
> ```
> 
> æ‰€ä»¥æˆ‘ä»¬åœ¨å®ç°åˆ†é¡µçš„æ—¶å€™å°±å¯ä»¥ç”¨limitæ¥é™åˆ¶æ¯é¡µå¤šå°‘æ¡æ•°æ®(ä¸€èˆ¬å›ºå®šä¸€ä¸ªå€¼)ï¼Œç”¨skipæ¥å†³å®šæ˜¾ç¤ºç¬¬å‡ é¡µ(ä¸€ä¸ªæœ‰è§„å¾‹å˜åŠ¨çš„å€¼)
> 
> # æ’åº
> åœ¨mongodbä¸­ä½¿ç”¨ä½¿ç”¨`sort()`æ–¹æ³•å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œ`sort()`æ–¹æ³•å¯ä»¥é€šè¿‡å‚æ•°æŒ‡å®šæ’åºçš„å­—æ®µï¼Œå¹¶ä½¿ç”¨1å’Œ-1æ¥æŒ‡å®šæ’åºçš„æ–¹å¼ï¼Œå…¶ä¸­1ä¸ºå‡åºæ’åˆ—ï¼Œè€Œ-1æ˜¯ç”¨äºé™åºæ’åˆ—ã€‚
> 
> 1	å‡åºæ’åˆ—
> -1	é™åºæ’åˆ—
> ```js
> db.é›†åˆå.find().sort({é”®å€¼(å±æ€§å€¼):1})
> ```
> 
> æŠŠ`age`é›†åˆè¡¨é‡æ–°æ ¹æ®`_id`ä¸»é”®è¿›è¡Œé™åºæ’åˆ—
> 
> ```js
> db.age.find().sort({
>   "_id": -1
> })
> ```
> 
> # Node.jsè¿æ¥
> å®‰è£…mongodbçš„æ¨¡å—
> 
> ```js
> npm install mongodb
> ```
> 
> ## 1.è¿æ¥æ•°æ®åº“
> ```js
> var MongoClient = require('mongodb').MongoClient;
> //ç»“å°¾æ˜¯é€‰æ‹©æ•°æ®åº“å
> var DB_CONN_STR = 'mongodb://localhost:27017/wscats';
> MongoClient.connect(DB_CONN_STR, function(err, db) {
>   console.log("è¿æ¥æˆåŠŸï¼");
> });
> ```
> 
> ## 2.æŸ¥è¯¢æ•°æ®
> æ³¨æ„æŸ¥è¯¢å›æ¥çš„ç»“æœéœ€è¦toArrayæ¥éå†å¤„ç†
> 
> ```js
> var MongoClient = require('mongodb').MongoClient;
> var DB_CONN_STR = 'mongodb://localhost:27017/wscats';
> 
> MongoClient.connect(DB_CONN_STR, function(err, db) {
>   console.log("è¿æ¥æˆåŠŸï¼");
>   //é€‰ä¸­ageé›†åˆï¼Œå¹¶ç”¨findæ–¹æ³•æŠŠç»“æœé›†æ‹¿å›æ¥è¿›è¡Œå¤„ç†
>   db.collection("age").find({title: "cba"}).toArray(function(err, result) {
>     if (err) {
>       console.log('Error:' + err);
>       return;
>     }
>     console.log(result);
>   });
> });
> ```
> 
> ç»è¿‡æµ‹è¯•ï¼Œè¯»å–å¤§äº100æ¡çš„æ—¶å€™ä¼šå‡ºç°æŠ¥é”™[å®˜ç½‘è§£é‡Š](https://docs.mongodb.com/manual/tutorial/iterate-a-cursor/#cursor-batches)ï¼Œå¯ä»¥å°è¯•ç”¨`forEach`ä»£æ›¿
> 
> ```js
> db.collection('pokemon').find({})
>   .forEach(function(item){
>       console.log(item)
>   })
> ```
> 
> ### æŸ¥è¯¢ID
> æŸ¥è¯¢è‡ªåŠ¨ç”Ÿæˆçš„`ObjectId`
> 
> ```js
> var ObjectId = require('mongodb').ObjectId;
> let _id = ObjectId("5bcae50ed1f2c2f5e4e1a76a");
> db.collection('xxx').find({
>     "_id": _id
> }).forEach(function (item) {
>     console.log(item)
> })
> ```
> 
> ## 3.æ’å…¥æ•°æ®
> insertå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦æ’å…¥çš„å€¼(å¯ä»¥ä¸€ä¸ªä¹Ÿå¯ä»¥å¤šä¸ª)ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“å€¼æ’å…¥æˆåŠŸåå›è¿”å›æ’å…¥å€¼å¾—ä¸€äº›å…³é”®ä¿¡æ¯ï¼Œæ¯”å¦‚`_id`
> 
> ```js
> var MongoClient = require('mongodb').MongoClient;
> var DB_CONN_STR = 'mongodb://localhost:27017/wscats';
> 
> MongoClient.connect(DB_CONN_STR, function(err, db) {
>   console.log("è¿æ¥æˆåŠŸï¼");
>	const db = client.db("demo");
>   db.collection("age").insert([
>     { 
>       title: "æ’å…¥çš„å€¼A"
>     }, {
>       title: "æ’å…¥çš„å€¼B"
>     }
>   ], function(err, result) {
>     if (err) {
>       console.log('Error:' + err);
>       return;
>     }
>     console.log(result)
>   })
> });
> ```
> 
> ## 4.æ›´æ–°æ•°æ®
> æ³¨æ„å¦‚æœä¸åŠ $setå°±æ˜¯å®Œå…¨æ›¿æ¢åŸæ¥çš„é‚£ä»½(æ²¡æœ‰è®¾ç½®çš„å±æ€§å€¼å°†ä¼šä¸¢å¤±)ï¼ŒåŠ ä¸Š$setåˆ™åªæ˜¯æ›´æ–°å¯¹åº”çš„å±æ€§å€¼ï¼Œå…¶ä½™ä¸åšæ”¹å˜
> 
> ```js
> var MongoClient = require('mongodb').MongoClient;
> var DB_CONN_STR = 'mongodb://localhost:27017/wscats';
> 
> MongoClient.connect(DB_CONN_STR, function(err, db) {
>   console.log("è¿æ¥æˆåŠŸï¼");
>   db.collection("age").update({
>     "_id": 1
>   }, {
>     $set: {
>       title: "ä½ å¥½ï¼Œä¸–ç•Œ",
>       skill: "js"
>     }
>   }, function(err, result) {
>     if (err) {
>       console.log('Error:' + err);
>       return;
>     }
>     //console.log(result);
>   });
> });
> ```
> 
> ## 5.åˆ é™¤æ•°æ®
> ```js
> var MongoClient = require('mongodb').MongoClient;
> var DB_CONN_STR = 'mongodb://localhost:27017/wscats';
> 
> MongoClient.connect(DB_CONN_STR, function(err, db) {
>   console.log("è¿æ¥æˆåŠŸï¼");
>   db.collection("age").remove({
>     "_id": 1
>   }, function(err, result) {
>     if (err) {
>       console.log('Error:' + err);
>       return;
>     }
>     //console.log(result);
>     //å…³é—­æ•°æ®åº“
>     db.close();
>   });
> });
> ```
> 
> ## 6.å…³é—­æ•°æ®åº“
> ```js
> db.close();
> ```
> 
> # å°è£…è‡ªå®šä¹‰æ¨¡å—
> æ–°å»º`mongo.js`å†™å…¥ä»¥ä¸‹ä»£ç ï¼Œå°è£…è‡ªå®šä¹‰æ¨¡å—ï¼Œæ–¹ä¾¿å…¶ä»–è·¯ç”±å¤ç”¨ï¼Œæ³¨æ„`assert`æ˜¯nodeè‡ªå¸¦çš„æ–­è¨€æ¨¡å—ï¼Œç”¨äºæµ‹è¯•ä»£ç 
> 
> å‚è€ƒ
> 
> * [å®˜ç½‘APIæ–‡æ¡£](http://nodejs.cn/api/assert.html)
> * [Node.jsçš„æ–­è¨€æ¨¡å—assertè¿›è¡Œå•å…ƒæµ‹è¯•](https://www.cnblogs.com/hong7zai/p/5909914.html)
> 
> ```js
> const MongoClient = require('mongodb').MongoClient;
> const assert = require('assert');
> const url = 'mongodb://localhost:27017';
> const dbName = 'shop';
> function query(callback) {
> 	MongoClient.connect(url, function(err, client) {
> 		assert.equal(null, err);
> 		console.log("Connected successfully to server");
> 		const db = client.db(dbName);
> 		callback(db);
> 		client.close();
> 	});
> }
> module.exports = {
> 	query
> }
> ```
> 
> åœ¨è·¯ç”±æ–‡ä»¶ä¸­å¼•å…¥å’Œä½¿ç”¨
> 
> ```js
> var mongo = require('./mongo.js')
> router.post('/addproduct', function(req, res, next) {
> 	mongo.query(function(db) {
> 		db.collection("product").insertMany([req.body], function(err, result) {
> 			console.log("Inserted 1 document into the collection");
> 			res.send('respond with a resource');
> 		});
> 	})
> });
> ```
>
### mongoose 
> 
### å¯è§†åŒ–
> * [Robo 3T](https://robomongo.org/)
> * [Studio3t](https://studio3t.com/download-thank-you/?OS=win64)




## Socket

### socket.io

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>socket.io</title>
  <script src="socket.io.js" charset="utf-8"></script>
</head>
<body>
  <h1>gp6 äº¤æµåŒº</h1>
  <div id="content" name="name" style="overflow-y: scroll; width: 400px; height: 300px; border: solid 1px #000"></div>
  <br />
  <div>
    <input type="text" id="msg" style="width: 200px;">
  </div>
  <button id="submit">æäº¤</button>
  <script>
    var socket = io.connect('http://10.9.164.98:8081');
    const content = document.getElementById('content')
    document.querySelector('#submit')
      .addEventListener('click', function () {
        var msg2 = msg.value
        socket.emit('receive', msg2)
        msg.value = ''
        content.innerHTML += msg2 + '<br/>'
      }, false)

      socket.on('message', function(msg){
        content.innerHTML += msg + '<br/>'
      })
  </script>
</body>
</html>

```
server.js

```js
var express = require('express');
var app = express();
var server = require('http').Server(app);
var io = require('socket.io')(server);

app.use(express.static(__dirname + '/client'))

io.on('connection', function (socket) {
  setInterval(function () {
    socket.emit('list', 'abc')
  }, 1000)
  socket.broadcast.emit('list', 'test');
  socket.on('backend', (msg) => {
    console.log(msg);
  })

  socket.on('receive', (msg) => {
    socket.broadcast.emit('message', msg);
  })
});

server.listen(8081, '10.9.164.98');

```
### netæ¨¡å—

serverCode
```js
const net = require('net')

const server = new net.createServer()

let clients = {}
let clientName = 0

server.on('connection', (client) => {
  client.name = ++clientName
  clients[client.name] = client

  client.on('data', (msg) => {
    // console.log('å®¢æˆ·ç«¯ä¼ æ¥ï¼š' + msg);
    broadcast(client, msg.toString())
  })

  client.on('error', (e) => {
    console.log('client error' + e);
    client.end()
  })

  client.on('close', (data) => {
    delete clients[client.name]
    console.log(client.name + ' ä¸‹çº¿äº†');
  })
})

function broadcast(client, msg) {
  for (var key in clients) {
    clients[key].write(client.name + ' è¯´ï¼š' + msg)
  }
}

server.listen(9000)
```
clientCode

```js
var net = require('net')
const readline = require('readline')

var port = 9000
var host = '127.0.0.1'

var socket = new net.Socket()

socket.setEncoding = 'UTF-8'

socket.connect(port, host, () => {
  socket.write('hello.')
})

socket.on('data', (msg) => {
  console.log(msg.toString())
  say()
})

socket.on('error', function (err) {
  console.log('error' + err);
})

socket.on('close', function () {
  console.log('connection closeed');
})

const r1 = readline.createInterface({
  input: process.stdin,
  output: process.stdout
})

function say() {
  r1.question('è¯·è¾“å…¥ï¼š', (inputMsg) => {
    if (inputMsg != 'bye') {
      socket.write(inputMsg + '\n')
    } else {
      socket.destroy()
      r1.close()
    }
  })
}

```
### websocket


```js
const ws = new WebSocket('ws://localhost:8080/')

ws.onopen = () => {
  ws.send('å¤§å®¶å¥½')
}

ws.onmessage = (msg) => {
  const content = document.getElementById('content')
  content.innerHTML += msg.data + '<br/>'
}

ws.onerror = (err) => {
  console.log(err);
}

ws.onclose = () => {
  console.log('closed~');
}
ws.send(msg2)
```

server.js

```js
const WebSocket = require('ws')
const ws = new WebSocket.Server({ port: 8080 })

let clients = {}
let clientName = 0

ws.on('connection', (client) => {
  client.name = ++clientName
  clients[client.name] = client

  client.on('message', (msg) => {
    broadcast(client, msg)
  })

  client.on('close', () => {
    delete clients[client.name]
    console.log(client.name + ' ç¦»å¼€äº†~')
  })
})

function broadcast(client, msg) {
  for (var key in clients) {
    clients[key].send(client.name + ' è¯´ï¼š' + msg)
  }
}

```


## é¡¹ç›®å®æˆ˜

### apiæ¥å£

* RestfulApi è§„èŒƒ
* æ¥å£æ–‡æ¡£çš„ç”Ÿæˆ(apidoc)
* æ¥å£è¯·æ±‚æ–¹å¼åŒºåˆ«

### è·¨åŸŸè§£å†³

* cors
* jsonp
* proxy

### èº«ä»½éªŒè¯

#### JWT

äº§ç”Ÿtoken

```
var jwt = require('jsonwebtoken');
var token = jwt.sign({ foo: 'bar' }, 'shhhhh');
```

éªŒè¯token 

```
// verify a token symmetric
jwt.verify(token, 'shhhhh', function(err, decoded) {
  console.log(decoded.foo) // bar
});
```

#### Cookie+Session

```
npm install express-session -d --save

app.use(session({
  secret: "weird sheep",
  resave: false,
  saveUninitialized: true,
  cookie: {user:"default",maxAge: 14*24*60*60*1000}
}));
sessionå­˜å€¼
req.session.user = user;
req.session.isLogin = true;
```

â€‹	

### å›¾ç‰‡ä¸Šä¼ 
1. å®‰è£…multeræ¨¡å—
```javascript
npm install multer
```

2. å¼•ç”¨æ¨¡å—
å®ƒæ˜¯ä¾èµ–äºexpressçš„ä¸€ä¸ªæ¨¡å—
```javascript
//å¼•ç”¨expresså¹¶é…ç½®
var express = require("express");
var app = express();
app.listen(3000);
```
```javascript
var multer = require('multer');
/*var upload = multer({
	//å¦‚æœç”¨è¿™ç§æ–¹æ³•ä¸Šä¼ ï¼Œè¦æ‰‹åŠ¨æ·»åŠ æ–‡æ˜ååç¼€
        //å¦‚æœç”¨ä¸‹é¢é…ç½®çš„ä»£ç ï¼Œåˆ™å¯ä»¥çœç•¥è¿™ä¸€å¥
	dest: 'uploads/'
})*/
```

3. é…ç½®
è®¾ç½®ä¿å­˜æ–‡ä»¶çš„åœ°æ–¹ï¼Œå¹¶æ ¹æ®ä¸Šä¼ çš„æ–‡ä»¶åå¯¹åº”æ–‡ä»¶æ·»åŠ åç¼€
å¯ä»¥é€šè¿‡`filename`å±æ€§å®šåˆ¶æ–‡ä»¶ä¿å­˜çš„æ ¼å¼

|å±æ€§å€¼|ç”¨é€”|
|-|-|
|`destination`|è®¾ç½®èµ„æºçš„ä¿å­˜è·¯å¾„ã€‚æ³¨æ„ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªé…ç½®é¡¹ï¼Œé»˜è®¤ä¼šä¿å­˜åœ¨`/tmp/uploads`ä¸‹ã€‚æ­¤å¤–ï¼Œè·¯å¾„éœ€è¦è‡ªå·±åˆ›å»º|
|`filename`|è®¾ç½®èµ„æºä¿å­˜åœ¨æœ¬åœ°çš„æ–‡ä»¶å|

```javascript
var storage = multer.diskStorage({
	//è®¾ç½®ä¸Šä¼ åæ–‡ä»¶è·¯å¾„ï¼Œuploadsæ–‡ä»¶å¤¹ä¼šè‡ªåŠ¨åˆ›å»ºã€‚
	destination: function(req, file, cb) {
		cb(null, './uploads')
	},
	//ç»™ä¸Šä¼ æ–‡ä»¶é‡å‘½åï¼Œè·å–æ·»åŠ åç¼€å
	filename: function(req, file, cb) {
		var fileFormat = (file.originalname).split(".");
		//ç»™å›¾ç‰‡åŠ ä¸Šæ—¶é—´æˆ³æ ¼å¼é˜²æ­¢é‡åå
		//æ¯”å¦‚æŠŠ abc.jpgå›¾ç‰‡åˆ‡å‰²ä¸ºæ•°ç»„[abc,jpg],ç„¶åç”¨æ•°ç»„é•¿åº¦-1æ¥è·å–åç¼€å
		cb(null, file.fieldname + '-' + Date.now() + "." + fileFormat[fileFormat.length - 1]);
	}
});
var upload = multer({
	storage: storage
});
```

4. æ¥å—æ–‡ä»¶
`upload.single('xxx')`ï¼Œxxxä¸è¡¨å•ä¸­çš„nameå±æ€§çš„å€¼å¯¹åº”
è¿™é‡Œè™½ç„¶ç”¨åˆ°postè¯·æ±‚ï¼Œä½†å®é™…ä¸Šä¸éœ€è¦`bodyParser`æ¨¡å—å¤„ç†
```javascript
app.post('/upload-single', upload.single('logo'), function(req, res, next) {
	console.log(req.file)
	console.log('æ–‡ä»¶ç±»å‹ï¼š%s', req.file.mimetype);
	console.log('åŸå§‹æ–‡ä»¶åï¼š%s', req.file.originalname);
	console.log((req.file.originalname).split("."))
	console.log('æ–‡ä»¶å¤§å°ï¼š%s', req.file.size);
	console.log('æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼š%s', req.file.path);
	res.send({
		ret_code: '0'
	});
});
```

5. å¤šå›¾ä¸Šä¼ 
å¤šå›¾ä¸Šä¼ åªè¦æ›´æ”¹ä¸€ä¸‹åœ°æ–¹ï¼Œå‰ç«¯å¾€fileè¾“å…¥æ¡†åŠ å¤šä¸€ä¸ª`multiple="multiple"`å±æ€§å€¼ï¼Œæ­¤æ—¶å°±å¯ä»¥åœ¨é€‰å›¾çš„æ—¶å€™å¤šé€‰äº†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å¹¶åˆ—å¤šä¸ªfileè¾“å…¥æ¡†(ä¸æ¨èå¤šä¸ªä¸Šä¼ å›¾ç‰‡è¾“å…¥æ¡†)ï¼Œè¿™æ ·ä½“éªŒä¼šä¸å¥½
```html
<input type="file" name="logo" multiple="multiple" />
```
åç«¯ä¹Ÿéœ€è¦ç›¸åº”çš„æ”¹å˜
```javascript
app.post('/upload-single', upload.single('logo'), function(req, res, next) {
//upload.single('logo')å˜ä¸ºupload.array('logo', 2)ï¼Œæ•°å­—ä»£è¡¨å¯ä»¥æ¥å—å¤šå°‘å¼ å›¾ç‰‡
app.post('/upload-single', upload.array('logo', 2), function(req, res, next) {
```
å¦‚æœä¸æƒ³æœ‰å›¾ç‰‡æ•°é‡ä¸Šä¼ é™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨`upload.any()`æ–¹æ³•
```javascript
app.post('/upload-single', upload.any(), function(req, res, next) {	
	res.append("Access-Control-Allow-Origin","*");
	res.send({
		wscats_code: '0'
	});
});
```

6. å‰ç«¯éƒ¨åˆ†
- formDataè¡¨å•æäº¤
```html
<form action="http://localhost:3000/upload-single" method="post" enctype="multipart/form-data">
	<h2>å•å›¾ä¸Šä¼ </h2>
	<input type="file" name="logo">
	<input type="submit" value="æäº¤">
</form>
```

- formDataè¡¨å•+ajaxæäº¤
```javascript
<form id="uploadForm">
	<p>æŒ‡å®šæ–‡ä»¶åï¼š <input type="text" name="filename" value="" /></p>
	<p>ä¸Šä¼ æ–‡ä»¶ï¼š <input type="file" name="logo" /></ p>
	<input type="button" value="ä¸Šä¼ " onclick="doUpload()" />
</form>
```
`FormData`å¯¹è±¡ï¼Œæ˜¯å¯ä»¥ä½¿ç”¨ä¸€ç³»åˆ—çš„é”®å€¼å¯¹æ¥æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„è¡¨å•ï¼Œç„¶åä½¿ç”¨`XMLHttpRequest`å‘é€è¿™ä¸ª"è¡¨å•"

**æ³¨æ„ç‚¹**

- processDataè®¾ç½®ä¸ºfalseã€‚å› ä¸ºdataå€¼æ˜¯FormDataå¯¹è±¡ï¼Œä¸éœ€è¦å¯¹æ•°æ®åšå¤„ç†ã€‚
- `<form>`æ ‡ç­¾æ·»åŠ `enctype="multipart/form-data"`å±æ€§ã€‚
- cacheè®¾ç½®ä¸ºfalseï¼Œä¸Šä¼ æ–‡ä»¶ä¸éœ€è¦ç¼“å­˜ã€‚
- contentTypeè®¾ç½®ä¸ºfalseã€‚å› ä¸ºæ˜¯ç”±`<form>`è¡¨å•æ„é€ çš„FormDataå¯¹è±¡ï¼Œä¸”å·²ç»å£°æ˜äº†å±æ€§`enctype="multipart/form-data"`ï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸ºfalse

ä¸Šä¼ åï¼ŒæœåŠ¡å™¨ç«¯ä»£ç éœ€è¦ä½¿ç”¨ä»æŸ¥è¯¢å‚æ•°åä¸ºlogoè·å–æ–‡ä»¶è¾“å…¥æµå¯¹è±¡ï¼Œå› ä¸º`<input>`ä¸­å£°æ˜çš„æ˜¯`name="logo"`

```javascript
function doUpload() {
	$.ajax({
		url: 'http://localhost:3000/upload-single',
		type: 'POST',
		cache: false, //ä¸å¿…é¡»
		data: new FormData($('#uploadForm')[0]),
		processData: false,//å¿…é¡»
		contentType: false,//å¿…é¡»
		success: function(data) {
			console.log(data)
		}
	})
}
```

> å‚è€ƒæ–‡æ¡£
[Github MyDemo](https://github.com/Wscats/node-tutorial/tree/master/uploadFiles)
[Github Multer](https://github.com/expressjs/multer)
[MDN FormDataå¯¹è±¡çš„ä½¿ç”¨](https://developer.mozilla.org/zh-CN/docs/Web/API/FormData/Using_FormData_Objects)



 